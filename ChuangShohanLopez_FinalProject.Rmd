---
title: "North Carolina’s Unsettling PM 2.5 Trajectory: 
Analyzing Power Plants and EJ Communities "
author: "Lauren Shohan, Jessalyn Chuang, Alex López"
output:
  bookdown::html_document2:
    df_print: paged
    toc: true
    fig_caption: yes
    geometry: margin=2.54cm
    fontsize: 12pt
    mainfont: Times New Roman
subtitle: https://github.com/jessalynlc/ChuangShohanLopez_ENV872_EDA_FinalProject
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
# Set your working directory
# Load your packages
library(tidyverse); library(lubridate); library(sf); library(leaflet)
library(mapview); library(leafsync); library(rvest); library(dataRetrieval)
library(dplyr); library(knitr); library(corrplot); library(bookdown)
library(here)
here()

# Set your ggplot theme
mytheme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black"), 
        legend.position = "top")
theme_set(mytheme)

# Load datasets

#NC Counties 
NC_counties<- st_read(here('Data/Spatial/cb_2018_us_county_20m.shp')) %>% 
  filter(STATEFP == 37) %>% 
  rename(COUNTY = NAME)

#power plant data set
powerplants <- st_read('https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Plants_gdb/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson') %>%
  filter(STATE == 'NC')

#power plant retirements
  #retirement_year contains all of the generators that retired in NC as of 
  #Oct 2024 from https://www.eia.gov/electricity/data/eia860m/
retirement_year <- read.csv(here('Data/retired_generators.csv')) %>% 
  filter(Plant.State == "NC") %>% 
  group_by(Plant.Name, Plant.ID, Retirement.Year) %>% 
  # Keep Retirement.Year as the first, latest unit retirement is considered
  #retirement year
  summarise(Retirement.Year = first(Retirement.Year),.groups = "drop")

#pm2.5 datasets
pm2.5_2013 <- read_csv(here('Data/EPA_PM2.5/EPA_PM25_NC2013.csv'))
pm2.5_2014 <- read_csv(here('Data/EPA_PM2.5/EPA_PM25_NC2014.csv')) 
pm2.5_2015 <- read_csv(here('Data/EPA_PM2.5/EPA_PM25_NC2015.csv')) 
pm2.5_2016 <- read_csv(here('Data/EPA_PM2.5/EPA_PM25_NC2016.csv')) 
pm2.5_2017 <- read_csv(here('Data/EPA_PM2.5/EPA_PM25_NC2017.csv')) 
pm2.5_2018 <- read_csv(here('Data/EPA_PM2.5/EPA_PM25_NC2018.csv')) 
pm2.5_2019 <- read_csv(here('Data/EPA_PM2.5/EPA_PM25_NC2019.csv')) 
pm2.5_2020 <- read_csv(here('Data/EPA_PM2.5/EPA_PM25_NC2020.csv')) 
pm2.5_2021 <- read_csv(here('Data/EPA_PM2.5/EPA_PM25_NC2021.csv')) 
pm2.5_2022 <- read_csv(here('Data/EPA_PM2.5/EPA_PM25_NC2022.csv')) 

#CDC datasets
  #wrangling 2014 data because 2014 gdb import does not work
SVI2014_csv <- read.csv(here('Data/Project_Data/NorthCarolina_county_2014.csv'), 
                        colClasses = c('FIPS' = 'factor'))
SVI2014_gdb <- NC_counties %>% 
  left_join(
    SVI2014_csv, 
    by = c("GEOID" = "FIPS") 
    )

SVI2016_gdb <- st_read(here('Data/Project_Data/SVI2016_NORTHCAROLINA_COUNTY.gdb'))
SVI2018_gdb <- st_read(here('Data/Project_Data/SVI2018_NORTHCAROLINA_COUNTY.gdb'))
SVI2020_gdb <- st_read(here('Data/Project_Data/SVI2020_NORTHCAROLINA_COUNTY.gdb'))
SVI2022_gdb <- st_read(here('Data/Project_Data/SVI2022_NORTHCAROLINA_COUNTY.gdb'))


```

# List of Tables

*Dataset Information*

- Table \@ref(tab:table1): NC Power Plant Summary <br>
- Table \@ref(tab:table2): SVI Summary <br>
- Table \@ref(tab:table3): PM2.5 Summary <br>
- Table \@ref(tab:table4): Retired Plants Summary <br>
- Table \@ref(tab:table5): NC Counties Summary <br>
- Table \@ref(tab:finaltable): Summary of Multiple Linear Regression Model

# List of Figures

*Exploratory Analysis*

- Figure 6.1: NC Coal-Burning Power Plants with BIT Primary Fuel Source <br>
- Figure 6.2: NC Coal-Burning Power Plants including BIT plants and 5 other Primary Fuel Types <br>
- Figure 6.3: Operating vs Retired NC Power Plants <br>
- Figure 6.4: Mean PM 2.5, SVI, and Power Plant Combined Map <br>

*Analysis*

- Figure \@ref(fig:corrplot1): Correlation Ellipse Plot <br>
- Figure \@ref(fig:corrplot2): Mixed Correlation Plot <br>
- Figure \@ref(fig:scatter1): Mean PM vs Number of Plants Scatter Plot <br>
- Figure \@ref(fig:scatter2): Mean PM vs overall SVI value Scatter Plot <br>

# Rationale and Research Questions
   This study investigates particulate matter (PM 2.5) air quality data alongside four Social Vulnerability Index (SVI) metrics across North Carolina counties and visually compares their proximity against retired and operating Power Plant locations. Environmental justice is an ever-concerning issue in America, and with the sudden increase in electricity consumption from the rise of data centers, it is important as ever to make sure injustices are not overlooked. The origins of the environmental justice movement stem from Warren County, North Carolina when an Africa-American community was chosen to be the location of a hazardous waste landfill, sparking national conversations about systemic environmental inequities. This historical context is the reason North Carolina was chosen as the area of focus for this research.  

   The study focuses on coal-burning power plants in particular because they are a major source of air pollution, specifically the very dangerous pollutant PM 2.5. PM 2.5 from coal combustion is rich in sulfur dioxide, black carbon, and metals which can enter a human’s lungs and bloodstream leading to conditions such as cancer, asthma, and even premature death. The NIH estimated from a study that for every 1 μg/m3 increase in coal PM 2.5, mortality in the studied regions increased by 1.12%. Given North Carolina’s unsettling environmental justice history, we seek to explore the connections between coal-burning power plants, amounts of PM 2.5 air pollution, and social vulnerability indices to potentially reveal disparities in air quality and publlic health impacts.  

# Research Questions

1. Is there a correlation between PM 2.5 concentrations in North Carolina and the proximity of coal-burning power plants? 

    a. Does the air quality improve in counties with retired plants compared to areas with operating plants? 

2. Do counties with higher Social Vulnerability Indexes (SVI) have higher concentrations of PM 2.5? 

    a. Are there more coal-burning powerplants in these counties? 

    b. Are there more clean energy powerplants in lower SVI counties? 

3. Is there a three-way relationship between coal-burning power plants, SVI, and PM 2.5 concentrations in North Carolina? In other words, assuming the null hypothesis that none of the predictors contribute to explaining the variance in PM2.5 concentrations, should we reject or fail to reject the null hypothesis?

# Dataset Information and Wrangling
This research consists of 5 different datasets: Power Plants, North Carolina Retired Generators, SVI Indexes, and Particulate Matter 2.5 Air Quality.  

## Power Plants and Retired Generators:  
  The Power Plant data set was collected from the open data site of the Geospatial Management Office of the U.S. Department of Homeland Security. The shapefile was created for the Homeland Infrastructure Foundation-Level Database and the Energy modeling community at large. This data contains electric power plants around the United States including the following plant types: hydroelectric dams, fossil fuels (coal, natural gas, or oil), nuclear, solar, wind, geothermal, and biomass. The man classifications that are used in this study are plant name, state location of plant, status of plant (Operating or Retired), primary fuel of plant, and geographic location.  

  The GeoJSON option of this data was copied and pasted into R Studio to bring in this dataset. This research narrowed the scope down to plants located in North Carolina. Then, primary fuel was narrowed to narrow out the plants that would not produce PM 2.5. According to EPA’s EGrid information, the abbreviations of plant primary fuel’s that are found within this dataset represent the following: BIT (blast furnace gas), AB (agricultural byproduct), BLQ (black liquor), DFO (distillate fuel oil, light fuel oil, FO2, diesel oil), LFG (landfill gas), NG (natural gas), OBG (digester gas, methane, and other biomass gases), SLW (sludge waste), WDS (wood, wood waste solid), WH (waste heat), SUN (solar), WND (wind), WAT (water), MWH (electricity), and NUC (nuclear). These plants were broken up into four categories: BIT only plants, other relatively moderate PM producing plants (WDS, SLW, BLQ, AB, and DFO), very low PM producing plants (LFG, NG, OBG, and WH), and a combination of BIT plants and the moderately producing PM plants. This last data frame was filtered for operating status of either operating or retired. Then, a second data set was merged to the retired plants data frame to add the column of retirement years. This data set is from U.S. Energy Information Administration ( https://www.eia.gov/electricity/data/eia860m/ ) and contains all generators retired in North Carolina as of October 2024. This was merged into the retired plants data frame by Plant Code and Plant ID. 

## Social Vulnerability Index: 
  The CDC's Social Vulnerability Index (SVI) dataset provides bi-annual data on indices that measure social vulnerability. These indices are organized into four key themes, each representing the average of various indicators: Theme 1 (Socioeconomic Status), Theme 2 (Household Composition and Disability), Theme 3 (Minority Status and Language), and Theme 4 (Housing Type and Transportation). Additionally, the dataset includes an overall summary ranking variable, which aggregates the values from these themes to provide a comprehensive measure of social vulnerability.	 

  Geodatabase data was pulled from the CDC website (https://www.atsdr.cdc.gov/place-health/php/svi/svi-data-documentation-download.html) in order to retain spatial information for mapping. There was an issue with importing 2014 geodatabase (GDB) data, so 2014 data was imported first as a CSV file. Data was filtered to include only counties in North Carolina (using STATEFP == 37). A join was performed between the NC Counties spatial data frame and the 2014 SVI data using the GEOID column from the spatial data and the FIPS column from the SVI data. Subsequently, SVI data for North Carolina counties from 2016, 2018, 2020, and 2022 were read as geodatabases as these were able to work straight from the website. To have dataframes that also allowed for GLM and linear regression analysis, additional non-spatial dataframes for SVI were created by using st_drop_geometry() to drop the spatial component of the SVI data.  

  Next, the code focuses on creating consolidated datasets for analysis. Four separate themes (Theme 1, Theme 2, Theme 3, and Theme 4) and an aggregate measure (RPL_THEMES) are processed by selecting the relevant theme columns from each dataset (2014, 2016, 2018, 2020, and 2022) and performing inner joins using FIPS as the key. The resulting data frames provide a longitudinal view of each theme's values across the years for each county. Column names are updated to reflect the year associated with each column. Finally, the code consolidates the themes and aggregate measures into respective data frames for further analysis, preparing the data for generalized linear model (GLM) analysis or other statistical approaches. 
 

## Particulate Matter: 
  The Particulate Matter (PM2.5) data set was collected from the United States Environmental Protection Agency website’s Outdoor Air Quality Data section (https://www.epa.gov/outdoor-air-quality-data). Using its “Download Daily Data” tool, we queried daily air quality summary statistics for the criteria pollutant PM2.5 by monitor in North Carolina for the years 2013 to 2022. The dataset includes values for Daily Mean PM2.5 Concentration, Daily AQI Value, and Daily Observation Count. 

  Since we are aiming to examine the relationship between PM2.5 pollution, social vulnerability indices, and power plants, we focused on the Daily Mean PM2.5 Concentration values and did not take Daily AQI Value and Daily Observation Count into consideration for the purposes of this study. After importing the EPA’s daily PM2.5 datasets for each of the years from 2013 to 2022 as data frames. We then converted these data frames into spatial data frames by using group_by() and only selecting the columns necessary to visualize and map each year’s PM2.5 data by county in North Carolina. The selected columns were: Site ID, County, Site Latitude, Site Longitude. New columns were also created using summarize() and named meanPM and maxPM, which provided us with the average of the Daily Mean PM2.5 Concentration and the maximum of the Daily Mean PM2.5 Concentration, respectively, for 2013 to 2022. 
 

## North Carolina Counties:
  The North Carolina Counties dataset was primarily uploaded to incorporate spatial information for the above datasets. This integration enables the mapping of data, which is a critical step for visualization and spatial analysis. This was used for linking the powerplant and SVI data with geographic boundaries, which helped facilitate the creation of maps that visually represent social vulnerability and powerplant locations across North Carolina counties, aiding in identifying spatial patterns. 


```{r data.summary, echo=FALSE}
#table that summarizes data structure (variables, units, ranges and/or central
#tendencies, data source if multiple are used, etc.)

## POWERPLANT SUMMARY AND KABLE 
powerplants_summary <- data.frame(
  Variable = c('PLANT_CODE', 'NAME', 'STATE', 'STATUS', 'COUNTY', 'COUNTYFIPS',
               'PRIM_FUEL', 'LATITUDE', 'LONGITUDE'),
  Description = c('Power Plant Code ID', 'Name of Power Plant', 'State Plant is 
  Located', 'Operating Status of Plant', 'County Plant is Located', 'County 
  FIPS', 'Primary Fuel of Plant', 'Latitude of Plant', 'Longitude of Plant'),
  Units = c('Character', 'Character', 'Character', 'Character', 'Character',
            'Character', 'Character', 'Double-precision decimal number', 
            'Double-precision decimal number')
)

SVI_summary <- data.frame(
  Variable = c('FIPS', 'STATE', 'RPL_THEME1', 'RPL_THEME2', 'RPL_THEME3', 
               'RPL_THEME4','RPL_THEMES', 'geometry'),
  Description = c('County FIPS Code', 'State', 'Theme 1 Percentile Ranking', 
                  'Theme 2 Percentile Ranking', 'Theme 3 Percentile Ranking', 
                  'Theme 4 Percentile Ranking', 
                  'Overall Summary Ranking Variable','Shape'),
  Units = c('Character', 'Character', 'Double-precision decimal number', 
            'Double-precision decimal number', 'Double-precision decimal number',
            'Double-precision decimal number', 'Double-precision decimal number',
            'sfc_MULTIPOLYGON')
)

PM2.5_summary <- data.frame(
  Variable = c('Date', 'Site ID', 'Daily Mean PM2.5 Concentration', 
               'Local Site Name', 'State', 'County', 'Site Latitude', 
               'Site Longitude'),
  Description = c('Date Data was Daten', 'ID Number of Site Location',
                  'Daily Mean of PM 2.5 Concentration', 'Name of Site',
                  'State of Site', 'County of Site', 'Site Latitude', 
                  'Site Longitude'),
  Units = c('Character', 'Number', 'Number in units of ug/m^3', 'Character',
            'Character', 'Character', 'Double-precision decimal number', 
            'Double-precision decimal number')
)

Retired_plants_summary <- data.frame(
  Variable = c('Plant.Name', 'Plant.ID', 'Retirement.Year'),
  Description = c('Name of Plant', 'Plant ID', 'Year Plant Retired'),
  Units = c('Character','Integer','Integer')
)

NC_counties_summary <- data.frame(
  Variable = c('STATEFP', 'COUNTY', 'geometry'),
  Description = c('State Code, 37 for NC', 'County Name', 'Geometry'),
  Units = c('Character', 'Character', 'sfc_MULTIPOLYGON')
  )
```

```{r table1, echo=FALSE}
knitr::kable(
  powerplants_summary, 
  caption = "NC Power Plant Summary"
)
```


```{r table2, echo=FALSE}
knitr::kable(
  SVI_summary, 
  caption = "SVI Data Summary"
)
```


```{r table3, echo=FALSE}
knitr::kable(
  PM2.5_summary, 
  caption = "PM 2.5 Data Summary"
)
```


```{r table4, echo=FALSE}
knitr::kable(
  Retired_plants_summary, 
  caption = "Retired Plants Summary"
)
```


```{r table5, echo=FALSE}
knitr::kable(
  NC_counties_summary, 
  caption = "North Carolina Counties Summary"
)
```

# Exploratory Analysis 

```{r PM2.5.visualization.data, include=FALSE}

#spatial visualization of 2013 PM2.5 data
pm2.5_sf_2013 <- pm2.5_2013 %>% 
  group_by(`Site ID`, County, `Site Latitude`, `Site Longitude`) %>% 
  summarize(
    meanPM = mean(`Daily Mean PM2.5 Concentration`,na.rm=T),
    maxPM = max(`Daily Mean PM2.5 Concentration`,na.rm=T)
    ) %>% 
  st_as_sf(coords = c('Site Longitude','Site Latitude'), crs=4269)

#2014 PM2.5 data
pm2.5_sf_2014 <- pm2.5_2014 %>% 
  group_by(`Site ID`, County, `Site Latitude`, `Site Longitude`) %>% 
  summarize(
    meanPM = mean(`Daily Mean PM2.5 Concentration`,na.rm=T),
    maxPM = max(`Daily Mean PM2.5 Concentration`,na.rm=T)
    ) %>% 
  st_as_sf(coords = c('Site Longitude','Site Latitude'), crs=4269)

#mapview(pm2.5_sf_2014, zcol = 'meanPM')

#2015 PM2.5 data
pm2.5_sf_2015 <- pm2.5_2015 %>% 
  group_by(`Site ID`, County, `Site Latitude`, `Site Longitude`) %>% 
  summarize(
    meanPM = mean(`Daily Mean PM2.5 Concentration`,na.rm=T),
    maxPM = max(`Daily Mean PM2.5 Concentration`,na.rm=T)
    ) %>% 
  st_as_sf(coords = c('Site Longitude','Site Latitude'), crs=4269)

#mapview(pm2.5_sf_2015, zcol = 'meanPM')

#2016 PM2.5 data
pm2.5_sf_2016 <- pm2.5_2016 %>% 
  group_by(`Site ID`, County, `Site Latitude`, `Site Longitude`) %>% 
  summarize(
    meanPM = mean(`Daily Mean PM2.5 Concentration`,na.rm=T),
    maxPM = max(`Daily Mean PM2.5 Concentration`,na.rm=T)
    ) %>% 
  st_as_sf(coords = c('Site Longitude','Site Latitude'), crs=4269)

#mapview(pm2.5_sf_2016, zcol = 'meanPM')

#2017 PM2.5 data
pm2.5_sf_2017 <- pm2.5_2017 %>% 
  group_by(`Site ID`, County, `Site Latitude`, `Site Longitude`) %>% 
  summarize(
    meanPM = mean(`Daily Mean PM2.5 Concentration`,na.rm=T),
    maxPM = max(`Daily Mean PM2.5 Concentration`,na.rm=T)
    ) %>% 
  st_as_sf(coords = c('Site Longitude','Site Latitude'), crs=4269)

#mapview(pm2.5_sf_2017, zcol = 'meanPM')

#2018 PM2.5 data
pm2.5_sf_2018 <- pm2.5_2018 %>% 
  group_by(`Site ID`, County, `Site Latitude`, `Site Longitude`) %>% 
  summarize(
    meanPM = mean(`Daily Mean PM2.5 Concentration`,na.rm=T),
    maxPM = max(`Daily Mean PM2.5 Concentration`,na.rm=T)
    ) %>% 
  st_as_sf(coords = c('Site Longitude','Site Latitude'), crs=4269)

#mapview(pm2.5_sf_2018, zcol = 'meanPM')

#2019 PM2.5 data
pm2.5_sf_2019 <- pm2.5_2019 %>% 
  group_by(`Site ID`, County, `Site Latitude`, `Site Longitude`) %>% 
  summarize(
    meanPM = mean(`Daily Mean PM2.5 Concentration`,na.rm=T),
    maxPM = max(`Daily Mean PM2.5 Concentration`,na.rm=T)
    ) %>% 
  st_as_sf(coords = c('Site Longitude','Site Latitude'), crs=4269)

#mapview(pm2.5_sf_2019, zcol = 'meanPM')

#2020 PM2.5 data
pm2.5_sf_2020 <- pm2.5_2020 %>% 
  group_by(`Site ID`, County, `Site Latitude`, `Site Longitude`) %>% 
  summarize(
    meanPM = mean(`Daily Mean PM2.5 Concentration`,na.rm=T),
    maxPM = max(`Daily Mean PM2.5 Concentration`,na.rm=T)
    ) %>% 
  st_as_sf(coords = c('Site Longitude','Site Latitude'), crs=4269)

#mapview(pm2.5_sf_2020, zcol = 'meanPM')

#2021 PM2.5 data
pm2.5_sf_2021 <- pm2.5_2021 %>% 
  group_by(`Site ID`, County, `Site Latitude`, `Site Longitude`) %>% 
  summarize(
    meanPM = mean(`Daily Mean PM2.5 Concentration`,na.rm=T),
    maxPM = max(`Daily Mean PM2.5 Concentration`,na.rm=T)
    ) %>% 
  st_as_sf(coords = c('Site Longitude','Site Latitude'), crs=4269)

#mapview(pm2.5_sf_2021, zcol = 'meanPM')

#2022 PM2.5 data
pm2.5_sf_2022 <- pm2.5_2022 %>% 
  group_by(`Site ID`, County, `Site Latitude`, `Site Longitude`) %>% 
  summarize(
    meanPM = mean(`Daily Mean PM2.5 Concentration`,na.rm=T),
    maxPM = max(`Daily Mean PM2.5 Concentration`,na.rm=T)
    ) %>% 
  st_as_sf(coords = c('Site Longitude','Site Latitude'), crs=4269)

#mapview(pm2.5_sf_2022, zcol = 'meanPM')

#finding the two-year average in order to do analysis with EJ data
#combine spatial data frames for the 2-year averages
pm2.5_sf_20132014 <- rbind(pm2.5_sf_2013, pm2.5_sf_2014)
pm2.5_sf_20152016 <- rbind(pm2.5_sf_2015, pm2.5_sf_2016)
pm2.5_sf_20172018 <- rbind(pm2.5_sf_2017, pm2.5_sf_2018)
pm2.5_sf_20192020 <- rbind(pm2.5_sf_2019, pm2.5_sf_2020)
pm2.5_sf_20212022 <- rbind(pm2.5_sf_2021, pm2.5_sf_2022)
```

```{r powerplant.visualization.data, include=FALSE}

### BIT POWER PLANTS
  #major producer of PM 2.5 -> 18 BIT power plants in NC! 
  #combo of three types: 
     #conventional steam coal, conventional steam coal/natural gas fired 
     #combustion turbine, and conventional steam coal/petroleum liquids
BITfuelpowerplants <- powerplants %>%
  filter(PRIM_FUEL == 'BIT')

#other relatively high PM 2.5 producing from non-coal options
  #WDS, SLW, BLQ, AB, DFO
HighPMfuelpowerplants <- powerplants %>%
  filter(PRIM_FUEL %in% c('WDS', 'SLW', 'BLQ', 'AB', 'DFO'))


#VERY low PM 2.5 emitting primary fuels, may be too small to even count
   #LFG, NG, OBG, WAT, WH
otherPMproducingfuelpowerplants <- powerplants %>%
  filter(PRIM_FUEL %in% c('LFG', 'NG', 'OBG', 'WH'))

#Combination of BIT plants and 5 other relatively moderate PM emitting types
BIT_and_High_powerplants <- powerplants %>%
  filter(PRIM_FUEL %in% c('BIT', 'WDS', 'SLW', 'BLQ', 'AB', 'DFO' ))

```

## Figure 6.1

Figure 6.1 is a map of North Carolina Coal-Burning Power Plants with BIT Primary Fuel Source.
```{r ncbit, fig.cap='6.1 Mapview of NC Coal-burning Power Plants', echo= FALSE}
#mapview of BIT powerplants with NC counties
mapview(
  BITfuelpowerplants,
  zcol = 'PRIM_FUEL',
  layer.name = 'Primary Fuel') +
  mapview(NC_counties, col.region = 'grey', legend = FALSE)
```

## Figure 6.2

Figure 6.2 is a map of North Carolina Power Plants including BIT plants and 5 other Primary Fuel Types (WDS, SLW, BLQ, AB, DFO).
```{r NC-COAL, fig.cap='6.2 Mapview of Top 6 PM Emitting Primary Fuel Power Plants in NC', echo=FALSE}
#mapview of BIT and pmpowerplants with NC counties
mapview(BITfuelpowerplants,
  zcol = 'PRIM_FUEL', layer.name = 'Primary Fuel') +
  mapview(HighPMfuelpowerplants,
          zcol = 'PRIM_FUEL',
          layer.name = 'Other Primary Fuels') +
  mapview(NC_counties, col.region = 'grey', legend = FALSE) 
```

```{r powerplants.operating.or.retired.data, include=FALSE}
#operating vs filtered 
operating_plants <- BIT_and_High_powerplants %>% filter(STATUS == 'OP')
retired_plants <- BIT_and_High_powerplants %>% filter(STATUS == 'RE')

#Convert PLANT_CODE to integer in retired_plants
retired_plants <- retired_plants %>%
  mutate(PLANT_CODE = as.integer(PLANT_CODE)) 

#Perform the join, one plant ENKA is missing retirement year
retired_plants <- retired_plants %>%
  left_join(retirement_year, by = c("PLANT_CODE" = "Plant.ID")) %>% 
  filter(Retirement.Year >= 2013)

#grouping operating vs retired by counties for further anaylsis 
countycount_OP_plants <- operating_plants %>%
  group_by(COUNTY, COUNTYFIPS) %>%
  summarize(Number_of_Plants = n())

countycount_RE_plants <- retired_plants %>%
  group_by(COUNTY, COUNTYFIPS, Retirement.Year) %>%
  summarize(Number_of_Plants = n())
```

## Figure 6.3

Figure 6.3 is a map of Operating vs. Retired North Carolina Power Plants.
As shown, all of the retired plants are BIT primary fuel plants, showing that
the highest PM emitting plants are being retired over other types. 
```{r NC-POWERPLANTS, fig.cap= '6.3 Operating and Retired NC Plants', echo=FALSE}
mapview(operating_plants, zcol = "PRIM_FUEL", col.region = 'blue',
        layer.name = 'Operating Plants: Primary Fuel') +
  mapview(retired_plants, zcol = "PRIM_FUEL", col.region = 'red',
          layer.name = 'Retired Plants: Primary Fuel') +
  mapview(NC_counties, col.region = 'grey', legend = FALSE)

#can see alot of retired ones are BIT 
```

```{r CDC.data.wrangling, include = FALSE}

# Remove spatial information from SVI datasets
SVI2014_df <- SVI2014_gdb %>% st_drop_geometry() 
SVI2016_df <- SVI2016_gdb %>% st_drop_geometry()
SVI2018_df <- SVI2018_gdb %>% st_drop_geometry()
SVI2020_df <- SVI2020_gdb %>% st_drop_geometry()
SVI2022_df <- SVI2022_gdb %>% st_drop_geometry() 

#Renaming the GEOID column to FIPS to be able to join with other dataframes more 
#easily
SVI2014_df <- SVI2014_df %>%
  rename(FIPS = GEOID)

# Perform the joins on the selected columns for each of the themes to be able to 
#do GLM analysis for each theme
theme1 <- SVI2014_df %>%
  select(FIPS, RPL_THEME1) %>%
  inner_join(SVI2016_df %>% select(FIPS, RPL_THEME1), by = "FIPS") %>%
  inner_join(SVI2018_df %>% select(FIPS, RPL_THEME1), by = "FIPS") %>%
  inner_join(SVI2020_df %>% select(FIPS, RPL_THEME1), by = "FIPS") %>%
  inner_join(SVI2022_df %>% select(FIPS, RPL_THEME1), by = "FIPS")

colnames(theme1) <- c("FIPS", 2014, 2016, 2018, 2020, 2022)

theme2 <- SVI2014_df %>%
  select(FIPS, RPL_THEME1) %>%
  inner_join(SVI2016_df %>% select(FIPS, RPL_THEME2), by = "FIPS") %>%
  inner_join(SVI2018_df %>% select(FIPS, RPL_THEME2), by = "FIPS") %>%
  inner_join(SVI2020_df %>% select(FIPS, RPL_THEME2), by = "FIPS") %>%
  inner_join(SVI2022_df %>% select(FIPS, RPL_THEME2), by = "FIPS")

colnames(theme2) <- c("FIPS", 2014, 2016, 2018, 2020, 2022)

theme3 <- SVI2014_df %>%
  select(FIPS, RPL_THEME1) %>%
  inner_join(SVI2016_df %>% select(FIPS, RPL_THEME3), by = "FIPS") %>%
  inner_join(SVI2018_df %>% select(FIPS, RPL_THEME3), by = "FIPS") %>%
  inner_join(SVI2020_df %>% select(FIPS, RPL_THEME3), by = "FIPS") %>%
  inner_join(SVI2022_df %>% select(FIPS, RPL_THEME3), by = "FIPS")

colnames(theme3) <- c("FIPS", 2014, 2016, 2018, 2020, 2022)

theme4 <- SVI2014_df %>%
  select(FIPS, RPL_THEME1) %>%
  inner_join(SVI2016_df %>% select(FIPS, RPL_THEME4), by = "FIPS") %>%
  inner_join(SVI2018_df %>% select(FIPS, RPL_THEME4), by = "FIPS") %>%
  inner_join(SVI2020_df %>% select(FIPS, RPL_THEME4), by = "FIPS") %>%
  inner_join(SVI2022_df %>% select(FIPS, RPL_THEME4), by = "FIPS")

colnames(theme4) <- c("FIPS", 2014, 2016, 2018, 2020, 2022)

theme_agg <- SVI2014_df %>%
  select(FIPS, RPL_THEMES) %>%
  inner_join(SVI2016_df %>% select(FIPS, RPL_THEMES), by = "FIPS") %>%
  inner_join(SVI2018_df %>% select(FIPS, RPL_THEMES), by = "FIPS") %>%
  inner_join(SVI2020_df %>% select(FIPS, RPL_THEMES), by = "FIPS") %>%
  inner_join(SVI2022_df %>% select(FIPS, RPL_THEMES), by = "FIPS")

colnames(theme_agg) <- c("FIPS", 2014, 2016, 2018, 2020, 2022)
```

```{r visualizing data, include=FALSE}
counties_view <- mapview(NC_counties, col.region = 'grey',legend = FALSE)

plants_view <- mapview(operating_plants, zcol = "PRIM_FUEL", col.region = 'blue',
                       layer.name = 'Operating Plants') +
  mapview(retired_plants, zcol = "PRIM_FUEL", col.region = 'red',
          layer.name = 'Retired Plants')

#Overall percentile visualization
map_overall_20132014 <- mapview(pm2.5_sf_20132014, zcol = "meanPM", col.regions = colorRampPalette(c("lightgreen", "green", "darkgreen")),
                                layer.name = '2013/2014 Mean PM') + 
  mapview(SVI2014_gdb, zcol = "RPL_THEMES", 
          col.regions = colorRampPalette(c("pink", "orange", "purple")), 
          layer.name = 'SVI 2014 RPL Theme') + 
  counties_view + plants_view


map_overall_20152016 <- mapview(pm2.5_sf_20152016, zcol = "meanPM", col.regions = colorRampPalette(c("lightgreen", "green", "darkgreen")),
                                layer.name = '2015/2016 Mean PM') + 
  mapview(SVI2016_gdb, zcol = "RPL_THEMES", 
          col.regions = colorRampPalette(c("pink", "orange", "purple")),
          layer.name = 'SVI 2016 RPL Theme') + 
  counties_view + plants_view

map_overall_20172018 <- mapview(pm2.5_sf_20172018, zcol = "meanPM", col.regions = colorRampPalette(c("lightgreen", "green", "darkgreen")),
                                layer.name = '2017/2018 Mean PM') + 
  mapview(SVI2018_gdb, zcol = "RPL_THEMES", 
          col.regions = colorRampPalette(c("pink", "orange", "purple")),
          layer.name = 'SVI 2018 RPL Theme') + 
  counties_view + plants_view

map_overall_20192020 <- mapview(pm2.5_sf_20192020, zcol = "meanPM", col.regions = colorRampPalette(c("lightgreen", "green", "darkgreen")),
                                layer.name = '2019/2020 Mean PM') + 
  mapview(SVI2020_gdb, zcol = "RPL_THEMES", 
          col.regions = colorRampPalette(c("pink", "orange", "purple")),
          layer.name = 'SVI 2020 RPL Theme') + 
  counties_view + plants_view
  
map_overall_20212022 <- mapview(pm2.5_sf_20212022, zcol = "meanPM", col.regions = colorRampPalette(c("lightgreen", "green", "darkgreen")),
                                layer.name = '2021/2022 Mean PM') + 
  mapview(SVI2022_gdb, zcol = "RPL_THEMES", 
          col.regions = colorRampPalette(c("pink", "orange", "purple")),
          layer.name = 'SVI 2022 RPL Theme') + 
  counties_view + plants_view
```

## Figure 6.4

Figure 6.4 is an interactive map of Mean PM 2.5 data, SVI Index, and Power Plants.
```{r COMBINED, echo=FALSE, fig.cap="6.4 Mean PM 2.5, SVI, and Power Plant Map"}
# Synchronize and display the maps side by side

library(htmlwidgets)

# Blank white box (placeholder)
blank_box <- htmltools::div(
  style = "width: 400px; height: 420px; background-color: white; border: 1px solid #ddd;"
)

sync(map_overall_20132014, map_overall_20152016, map_overall_20172018, map_overall_20192020, map_overall_20212022, blank_box)

```

These maps provide a visualization of PM2.5 concentration levels and SVI percentiles across North Carolina over several two-year time periods (2013–2014, 2015–2016, 2017–2018, 2019–2020, and 2021–2022). The maps highlight distinct regional trends in both air quality and social vulnerability, illustrating how these factors evolve over time and interact geographically. 

In general, the PM2.5 concentration levels demonstrate a statewide downward trend, with lower concentrations observed in later years compared to earlier periods. However, the western part of the state consistently shows areas with higher PM2.5 concentrations, particularly near counties where operating power plants and other industrial facilities are located. For instance, counties near active BLQ and DFO units in western North Carolina display elevated PM2.5 levels in the earlier years, which may reflect their proximity to emissions sources. 

The SVI percentiles reveal clusters of higher social vulnerability in the eastern part of the state, particularly in counties where PM2.5 monitors are sparse. These areas with higher social vulnerability often overlap with historically underserved communities that may be at greater risk due to a lack of air quality monitoring and mitigation measures. Some western counties, such as Jackson and Swain, show increasing SVI percentiles alongside worsening PM2.5 levels in certain periods. Counties like Cleveland and Mecklenburg reflect notable changes over time. Cleveland County, home to a plant in Shelby, shows increased social vulnerability after 2014, coinciding with higher environmental risks. Mecklenburg County exhibits worsening PM2.5 levels and an increased SVI percentile by 2022. Montgomery County and Halifax County also experience slight increases in PM2.5 levels and SVI values, likely influenced by the presence of nearby industrial units. Interestingly, Hyde County in the eastern region exhibits a rising SVI percentile despite a general reduction in PM2.5 levels over the years, suggesting that social factors driving vulnerability may not be directly linked to air quality improvements. The maps also highlight scale adjustments in PM2.5 measurements, with generally lower concentration levels in later years, reflecting statewide efforts to reduce particulate pollution. 

These findings underscore the complex relationship between air quality and social vulnerability, highlighting the need for targeted interventions in areas facing persistent social and environmental challenges. While the western part of the state, characterized by lower SVI values, appears to have higher PM2.5 concentrations, it is crucial to consider the lack of PM2.5 monitors in the eastern regions where SVI tends to be higher. This monitoring gap may obscure evidence of potentially rising PM2.5 concentrations in areas with higher social vulnerability, underscoring the need for improved air quality surveillance in underserved regions. 
\newpage

# Analysis

## GLMs/Linear Regression:

Null Hypothesis: None of the predictors contribute to explaining the variance in PM2.5 concentrations.

Alternate Hypothesis: At least one of the predictors contributes to explaining the variance in PM2.5 concentrations.

```{r Data Wrangling for Linear Regression, include= FALSE}

#add column titled 'FIPS' to all the PM2.5 data frames combining existing columns
#titled 'State FIPS Code' and 'County 'FIPS Code', with the goal of then
#combining with the SVI data frames which have 'FIPS' columns already

pm2.5_2013 <- pm2.5_2013 %>%
  mutate(FIPS = paste0(`State FIPS Code`, `County FIPS Code`)) 

pm2.5_2014 <- pm2.5_2014 %>%
  mutate(FIPS = paste0(`State FIPS Code`, `County FIPS Code`))

pm2.5_2015 <- pm2.5_2015 %>%
  mutate(FIPS = paste0(`State FIPS Code`, `County FIPS Code`))

pm2.5_2016 <- pm2.5_2016 %>%
  mutate(FIPS = paste0(`State FIPS Code`, `County FIPS Code`))

pm2.5_2017 <- pm2.5_2017 %>%
  mutate(FIPS = paste0(`State FIPS Code`, `County FIPS Code`))

pm2.5_2018 <- pm2.5_2018 %>%
  mutate(FIPS = paste0(`State FIPS Code`, `County FIPS Code`))

pm2.5_2019 <- pm2.5_2019 %>%
  mutate(FIPS = paste0(`State FIPS Code`, `County FIPS Code`))

pm2.5_2020 <- pm2.5_2020 %>%
  mutate(FIPS = paste0(`State FIPS Code`, `County FIPS Code`))

pm2.5_2021 <- pm2.5_2021 %>%
  mutate(FIPS = paste0(`State FIPS Code`, `County FIPS Code`))

pm2.5_2022 <- pm2.5_2022 %>%
  mutate(FIPS = paste0(`State FIPS Code`, `County FIPS Code`))

#combine PM2.5 data frames for 2-year averages once again

pm2.5_20132014 <- rbind(pm2.5_2013, pm2.5_2014) %>% 
  group_by(`State FIPS Code`, `County FIPS Code`, `County`, `FIPS`) %>% 
  summarize(
    meanPM = mean(`Daily Mean PM2.5 Concentration`,na.rm=T),
    maxPM = max(`Daily Mean PM2.5 Concentration`,na.rm=T)
    )
pm2.5_20152016 <- rbind(pm2.5_2015, pm2.5_2016) %>% 
  group_by(`State FIPS Code`, `County FIPS Code`, `County`, `FIPS`) %>% 
  summarize(
    meanPM = mean(`Daily Mean PM2.5 Concentration`,na.rm=T),
    maxPM = max(`Daily Mean PM2.5 Concentration`,na.rm=T)
    )
pm2.5_20172018 <- rbind(pm2.5_2017, pm2.5_2018) %>% 
  group_by(`State FIPS Code`, `County FIPS Code`, `County`, `FIPS`) %>% 
  summarize(
    meanPM = mean(`Daily Mean PM2.5 Concentration`,na.rm=T),
    maxPM = max(`Daily Mean PM2.5 Concentration`,na.rm=T)
    )
pm2.5_20192020 <- rbind(pm2.5_2019, pm2.5_2020) %>% 
  group_by(`State FIPS Code`, `County FIPS Code`, `County`, `FIPS`) %>% 
  summarize(
    meanPM = mean(`Daily Mean PM2.5 Concentration`,na.rm=T),
    maxPM = max(`Daily Mean PM2.5 Concentration`,na.rm=T)
    )
pm2.5_20212022 <- rbind(pm2.5_2021, pm2.5_2022) %>% 
  group_by(`State FIPS Code`, `County FIPS Code`, `County`, `FIPS`) %>% 
  summarize(
    meanPM = mean(`Daily Mean PM2.5 Concentration`,na.rm=T),
    maxPM = max(`Daily Mean PM2.5 Concentration`,na.rm=T)
    )
#add year labels to each data frame
pm2.5_20132014$year <- 2014
pm2.5_20152016$year <- 2016
pm2.5_20172018$year <- 2018
pm2.5_20192020$year <- 2020
pm2.5_20212022$year <- 2022
#combine the data frames into one
pm2.5_all <- rbind(pm2.5_20132014, pm2.5_20152016, pm2.5_20172018, 
                   pm2.5_20192020, pm2.5_20212022)
#merge operating plant counts
pm2.5_all <- pm2.5_all %>%
  mutate(County_lower = tolower(`County`))  # Add a temporary lowercase column
pm2.5_all <- pm2.5_all %>%
   left_join(
    countycount_OP_plants %>% mutate(COUNTY_lower = tolower(COUNTY)),
    by = c("County_lower" = "COUNTY_lower"))

#Based on countycount_RE_plants df
#for Chatham (add 4 for 2014)
pm2.5_all$Number_of_Plants[6] <- 4

#for New Hanover (add 8 for 2014, add 4 for 2016 and 2018)
pm2.5_all$Number_of_Plants[26] <- 8
pm2.5_all$Number_of_Plants[57] <- 4
pm2.5_all$Number_of_Plants[81] <- 4

#for Gaston (add 4 for 2014)
pm2.5_all$Number_of_Plants[13] <- pm2.5_all$Number_of_Plants[13] + 4

#for Bladen (add 1 for 2014, 2016, 2018) - no PM2.5 monitor so did not add

#for Edgecombe (add 1 for 2014, 2016, 2018, 2020)
pm2.5_all$Number_of_Plants[11] <- 1
pm2.5_all$Number_of_Plants[37] <- 1
pm2.5_all$Number_of_Plants[70] <- 1
pm2.5_all$Number_of_Plants[91] <- 1

# Reshape theme_agg from wide to long format
theme_agg_long <- theme_agg %>%
  pivot_longer(
    cols = -FIPS, # Keep FIPS as is; all other columns (years) will be reshaped
    names_to = "year", # Create a new column named 'year' from the wide column headers
    values_to = "theme_agg_value" # Create a column for the values
  )

theme1_long <- theme1 %>%
  pivot_longer(
    cols = -FIPS, # Keep FIPS as is; all other columns (years) will be reshaped
    names_to = "year", # Create a new column named 'year' from the wide column headers
    values_to = "theme1_value" # Create a column for the values
  )

theme2_long <- theme2 %>%
  pivot_longer(
    cols = -FIPS, # Keep FIPS as is; all other columns (years) will be reshaped
    names_to = "year", # Create a new column named 'year' from the wide column headers
    values_to = "theme2_value" # Create a column for the values
  )

theme3_long <- theme3 %>%
  pivot_longer(
    cols = -FIPS, # Keep FIPS as is; all other columns (years) will be reshaped
    names_to = "year", # Create a new column named 'year' from the wide column headers
    values_to = "theme3_value" # Create a column for the values
  )

theme4_long <- theme4 %>%
  pivot_longer(
    cols = -FIPS, # Keep FIPS as is; all other columns (years) will be reshaped
    names_to = "year", # Create a new column named 'year' from the wide column headers
    values_to = "theme4_value" # Create a column for the values
  )

# Ensure the 'year' column is numeric to match pm2.5_all
theme_agg_long$year <- as.numeric(theme2_long$year)
theme1_long$year <- as.numeric(theme1_long$year)
theme2_long$year <- as.numeric(theme2_long$year)
theme3_long$year <- as.numeric(theme3_long$year)
theme4_long$year <- as.numeric(theme4_long$year)

# Ensure FIPS is consistent in both datasets (character type)
pm2.5_all$COUNTYFIPS <- as.character(pm2.5_all$COUNTYFIPS)
theme_agg_long$FIPS <- as.character(theme_agg_long$FIPS)
theme1_long$FIPS <- as.character(theme1_long$FIPS)
theme2_long$FIPS <- as.character(theme2_long$FIPS)
theme3_long$FIPS <- as.character(theme3_long$FIPS)
theme4_long$FIPS <- as.character(theme4_long$FIPS)

# Rename FIPS in theme dataframes to COUNTYFIPS
#colnames(theme_agg_long)[colnames(theme_agg_long) == "FIPS"] <- "COUNTYFIPS"
#colnames(theme1_long)[colnames(theme1_long) == "FIPS"] <- "COUNTYFIPS"
#colnames(theme2_long)[colnames(theme2_long) == "FIPS"] <- "COUNTYFIPS"
#colnames(theme3_long)[colnames(theme3_long) == "FIPS"] <- "COUNTYFIPS"
#colnames(theme4_long)[colnames(theme4_long) == "FIPS"] <- "COUNTYFIPS"

# Merge pm2.5_all with reshaped theme dataframes
combined_data <- merge(pm2.5_all, theme_agg_long, by = c("FIPS", "year"), 
                       all.x = TRUE)
combined_data <- merge(combined_data, theme1_long, by = c("FIPS", "year"), 
                       all.x = TRUE)
combined_data <- merge(combined_data, theme2_long, by = c("FIPS", "year"), 
                       all.x = TRUE)
combined_data <- merge(combined_data, theme3_long, by = c("FIPS", "year"), 
                       all.x = TRUE)
combined_data <- merge(combined_data, theme4_long, by = c("FIPS", "year"), 
                       all.x = TRUE)

#cleaning up combined_data
combined_data <- combined_data %>%
  select(-c(County_lower, COUNTY, COUNTYFIPS))
```

```{r corrplot1, echo = FALSE, fig.cap = "Correlation Ellipse Plot"} 
#Correlation Plots: Exploratory plots of several continuous data points to 
#determine possible relationships, as well as covariance among explanatory 
#variables
combined_selectedcolumns <- 
  combined_data %>%
  select(meanPM, theme_agg_value, Number_of_Plants, theme1_value, theme2_value, 
         theme3_value, theme4_value) %>%
  na.omit()
combined_data_corplot <- cor(combined_selectedcolumns)
corrplot(combined_data_corplot, method = "ellipse")
```
Figure \@ref(fig:corrplot1) Analysis of Correlation Plot:\
When looking at the Correlation Ellipse Plot, we are looking at (i) the elliptical shape, (ii) the direction/slope of the ellipse, and (iii) the intensity of the ellipse's color to examine pairwise correlations. According to our correlation plot, the strongest correlations across 2014 to 2022 appear for the following variable pairs: (a) the aggregate of all four SVI themes and SVI theme 1, and (b) the aggregate of all four SVI themes and SVI theme 4, since the narrower ellipse shapes and darker ellipse colors suggest a very high correlation among these pairs. This makes sense since SVI theme 1 is one of the four themes that make up the SVI aggregate. Although the elliptical shapes and color intensities suggest strong correlations between the other SVI themes, individually, and the SVI aggregate, it is not as strong as the two pairs of variables first mentioned.  

```{r corrplot2, echo = FALSE, fig.cap = "Mixed Correlation Plot"}
corrplot.mixed(combined_data_corplot, upper = "ellipse")
```
Figure \@ref(fig:corrplot2) Further correlation plot analysis:\
When looking at the mixed correlation plot, which combines the ellipses with the exact correlation values, we can confirm our prior observations when we see the correlation values for (a) the SVI aggregate and SVI theme 1 and (b) the SVI aggregate and SVI theme 4 are 0.85 and 0.78, respectively. Unfortunately, since the aim of the study is to examine the relationship, if any, between PM2.5 concentration, number of power plants, and SVI indices by county in North Carolina, the results from the correlation plots do not tell us much, if anything, about such a relationship. 

```{r Linear.Regression.data, include = FALSE}
#run linear regression from 2014 to 2022 using PM2.5 as independent variable and 
#SVI measures and power plant count data as explanatory variables

multi.lin.reg <- lm(data = combined_data, meanPM ~ 
                        theme1_value+ theme2_value + theme3_value +
                      theme4_value + Number_of_Plants)
```

Using the AIC method to select variables to compute a stepwise regression that either adds explanatory variables from the bottom up or removes explanatory variables from a full set of suggested options. The smaller the AIC value, the better.
```{r AIC analysis}
step(multi.lin.reg)
```

```{r linear.regression.summary}
summary(multi.lin.reg)
```

**Analysis of multi linear regression/AIC:**

  The AIC analysis and stepwise regression process aimed to identify the best-fitting linear regression model to potentially predict meanPM by minimizing the AIC value. The initial model included theme1_value, theme2_value, theme3_value, theme4_value, and Number_of_Plants as predictors, with an AIC of 49.31. During the stepwise selection process, it was determined that removing theme3_value resulted in the largest reduction in AIC, improving the value to 47.65. This indicates that them3_value (minority status and language) contributed the least out of the four themes for explaining variance in meanPM. The final model retained theme1_value, theme2_value, theme4_value, and Number_of_Plants as predictors, with an AIC of 47.65.
  
  The summary of the multiple linear regression model provides more insights in the relationship between meanPM and the potential predictors. The model’s intercept is statistically significant (p<0.001), indicating the baseline value of meanPM when all predictors are zero is about 6.32 micrograms. Among the predictors, theme1_value is statistically significant with a coefficient of –2.6377 (p = 0.0153). This negative relationship suggests that higher values of these index may be associated with lower PM2.5 concentrations. Theme2_value shows a positive coefficient of 1.7538 and approaches significance (p = 0.0611), suggesting a potential positive association with PM2.5 concentrations, though further analysis and/or data may be needed to confirm this. The remaining predictors (theme 3, theme 4, and number of plants) were not statistically significant as their p-values exceeded the 0.05 threshold, suggesting their relationship with meanPM is weaker, less consistent, or even non-existent in the model. The model's overall performance, as indicated by the R-squared value of 0.1445, shows that the predictors collectively explain approximately 14.45% of the variance in meanPM. This relatively low R-squared value suggests there are additional factors influencing PM2.5 concentrations that are not captured by the model. The F-statistic (2.925, p = 0.02115) indicates that the model, as a whole, is statistically significant, meaning the predictors contribute to explaining variations in PM2.5 concentrations to some extent, and therefore, we can reject the null hypothesis in favor of the alternate hypothesis, which states that at least one of the predictors contributes to explaining the variance in PM2.5 concentrations.

```{r scatter1, echo = FALSE, fig.cap = "PM 2.5 Data vs Number of Plants Plot", message = FALSE, warning = FALSE}
#create 2 scatter plots: (i) PM2.5 data vs power plant count data and (ii) PM2.5 data vs SVI aggregate (all from 2014 to 2022)
#Scatterplot 1
pm2.5_powerplantcount <- 
  ggplot(combined_data, aes(x = Number_of_Plants, y = meanPM)) +
  geom_smooth(method = "lm") +
  scale_y_log10() +
  geom_point() +
  labs(x = 'Number of Plants', y = 'Mean PM 2.5 (ug/m^3)', title = 
         'PM 2.5 Data vs Number of Plants Plot')
print(pm2.5_powerplantcount)
```

```{r scatter2, echo = FALSE, fig.cap = "PM 2.5 Data vs SVI Aggregate Plot", message = FALSE}
#Scatterplot 2
pm2.5_SVIaggregate <- 
  ggplot(combined_data, aes(x = theme_agg_value, y = meanPM)) +
  geom_smooth(method = "lm") +
  scale_y_log10() +
  geom_point() +
  labs(x = 'Theme Aggregate Value', y = 'Mean PM 2.5 (ug/m^3)', title = 
         'PM 2.5 Data vs SVI Aggregate Plot')
print(pm2.5_SVIaggregate)
```

Figure \@ref(fig:scatter1) and Figure \@ref(fig:scatter2):\
  Analysis of scatterplots: After plotting the relationships of (i) mean PM2.5 and the number of power plants from 2014 to 2022 and (ii) mean PM2.5 and the SVI aggregate from 2014 to 2022, the resulting scatterplots confirm that there appears to be no significant, or there is a very miniscule, relationship between PM2.5 and each of the number of power plants and the SVI aggregate for the years 2014 to 2022.

# Summary and Conclusions


This study investigates the relationship between PM2.5 air pollution, SVI metrics, and coal-burning power plants across North Carolina, a state with a significant history of environmental justice issues. Using datasets on power plants, SVI, and air quality from 2013 to 2022, the research explores disparities in air quality and public health impacts, highlighting the intersections of environmental and social factors.

Key findings from spatial visualization include:

1. PM2.5 concentrations have generally declined statewide over the years, reflecting efforts to reduce pollution. However, western counties near operating power plants often show persistently higher concentrations.

2. Counties with higher SVI scores, predominantly in the eastern region, often coincide with historically underserved communities. These areas frequently lack sufficient air quality monitoring, which may obscure potential risks and limited our ability to fully analyze relationships due to the scarcity of PM2.5 monitors.

3. Retired coal plants, which are the largest contributors to PM2.5 pollution, have led to noticeable improvements in air quality in nearby counties.

4. Certain counties, like Cleveland and Mecklenburg, showed worsening social vulnerability alongside air quality challenges, underscoring localized disparities.

  Further statistical analysis was done to examine relationships between the PM2.5, SVI, and power plant locations in NC. Our analyses using GLMs confirmed that while at least one of the SVI themes may contribute to the variance in PM2.5 concentrations in NC, there must be additional factors/variables we did not account for in this study that better explain the variance in PM2.5 concentrations across North Carolina’s counties. Despite a statistically significant F-statistic for the overall multi regression model, the R-squared value is quite low. Additionally, the correlation plots and scatter plots confirmed the lack of a strong relationship (i) between PM2.5 concentrations and the explanatory variables collectively and (ii) between PM2.5 concentrations and each of the explanatory variables, individually.

```{r finaltable, echo=FALSE}
variable <- c("Theme 1 Index", "Theme 2 Index", "Theme 3 Index", "Theme 4 Index",
              "Number of Plants")
Tau <- c(-2.509, 1.914, 0.553, 1.366, 1.432)
P <- c("=< 0.0153","=< 0.0611", "=< 0.5824", "=< 0.1778", "=< 0.1581")
finaltable <- data.frame(variable, Tau, P)
colnames(finaltable) <- c("Variable", "Tau value", "P-value")
  
knitr::kable(finaltable, caption ="List of tau values and p-values from the multiple linear regression model.")
```

# References
1.  "Environmental Justice History." U.S. Department of Energy, www.energy.gov/lm/environmental-justice-history.

2. Doctrow, Brian. "Deaths associated with pollution from coal power plants." National Institutes of Health, 12 Dec. 2023, www.nih.gov/news-events/nih-research-matters/deaths-associated-pollution-coal-power-plants.

3. "EGrid ." Environmental Protection Agency, www.epa.gov/egrid/code-lookup.


